<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <!-- iPhone √ßentik dahil tam ekran -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- PWA / Uygulama modu -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Alƒ±≈üveri≈ü Asistanƒ±m">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#000000">
  <link rel="manifest" href="manifest.json">

  <title>Alƒ±≈üveri≈ü Asistanƒ±m</title>

  <style>
    :root {
      --bg: #f4f5fb;
      --primary: #4f46e5;
      --primary-soft: #e0e7ff;
      --danger: #f97373;
      --accent: #22c55e;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --card-bg: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      background: radial-gradient(circle at top, #e0f2fe, #eef2ff 40%, #e5e7eb);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
    }

    .app-shell {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;

      /* iPhone √ßentik / alt bar i√ßin g√ºvenli alan */
      padding-top: calc(16px + env(safe-area-inset-top));
      padding-bottom: calc(16px + env(safe-area-inset-bottom));
      padding-left: calc(16px + env(safe-area-inset-left));
      padding-right: calc(16px + env(safe-area-inset-right));
    }

    .card {
      width: 100%;
      max-width: 520px;
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
      padding: 16px 16px 18px;
      position: relative;
      overflow: hidden;
    }

    .card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top left, #4f46e515, transparent 70%);
      pointer-events: none;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 10px;
    }

    .logo-pill {
      width: 62px;
      height: 62px;
      border-radius: 18px;
      background: radial-gradient(circle at top, #22c55e, #16a34a);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 24px rgba(22, 163, 74, 0.4);
      flex-shrink: 0;
    }

    .logo-pill span {
      font-size: 30px;
    }

    .title-block h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    .title-block p {
      margin: 2px 0 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .pill {
      font-size: 11px;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      color: #6b7280;
    }

    .status-pill {
      margin-left: auto;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      font-size: 11px;
      border-radius: 999px;
      background: #ecfdf3;
      color: #15803d;
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #22c55e;
    }

    .tabs {
      display: flex;
      gap: 8px;
      margin: 14px 0 12px;
      overflow-x: auto;
      padding-bottom: 2px;
    }

    .tab-btn {
      border: none;
      outline: none;
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 13px;
      background: #f3f4ff;
      color: #4b5563;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      flex-shrink: 0;
    }

    .tab-btn span.emoji {
      font-size: 14px;
    }

    .tab-btn.active {
      background: #4f46e5;
      color: white;
      box-shadow: 0 8px 20px rgba(79, 70, 229, 0.45);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1.5fr 0.6fr 0.9fr;
      gap: 8px;
      margin-bottom: 8px;
    }

    .form-row-2 {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 8px;
      margin-bottom: 10px;
    }

    .input {
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 7px 9px;
      font-size: 13px;
      outline: none;
      width: 100%;
      background: #f9fafb;
    }

    .input:focus {
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px #4f46e520;
      background: white;
    }

    .input::placeholder {
      color: #9ca3af;
    }

    .btn-primary {
      border: none;
      outline: none;
      border-radius: 11px;
      background: #16a34a;
      color: white;
      font-size: 14px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding: 0 16px;
      cursor: pointer;
      box-shadow: 0 12px 26px rgba(22, 163, 74, 0.6);
    }

    .btn-primary:active {
      transform: translateY(1px);
      box-shadow: 0 6px 16px rgba(22, 163, 74, 0.7);
    }

    .totals-row {
      display: grid;
      grid-template-columns: 1.1fr 1.1fr;
      gap: 8px;
      margin-bottom: 10px;
    }

    .total-card {
      border-radius: 12px;
      background: #f9fafb;
      padding: 8px 10px;
      border: 1px solid #e5e7eb;
    }

    .total-label {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .total-value {
      font-size: 17px;
      font-weight: 700;
    }

    .total-subline {
      font-size: 11px;
      color: #9ca3af;
      margin-top: 1px;
    }

    .total-badge {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
    }

    .chip-danger {
      background: #fef2f2;
      color: #b91c1c;
    }

    .list-section {
      margin-top: 4px;
      border-top: 1px dashed #e5e7eb;
      padding-top: 8px;
      max-height: 260px;
      overflow-y: auto;
    }

    .list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .badge-count {
      padding: 2px 7px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      font-size: 10px;
    }

    .item-row {
      display: grid;
      grid-template-columns: auto 1fr auto;
      align-items: center;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px dashed #e5e7eb80;
    }

    .item-left {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .item-name {
      font-size: 13px;
      font-weight: 500;
    }

    .item-meta {
      font-size: 11px;
      color: #9ca3af;
    }

    .category-pill {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }

    .item-price {
      font-size: 12px;
      font-weight: 600;
      color: #111827;
      text-align: right;
    }

    .item-actions {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .btn-link {
      border: none;
      background: none;
      font-size: 11px;
      color: #9ca3af;
      padding: 0;
      cursor: pointer;
    }

    .btn-link.danger {
      color: #ef4444;
    }

    .checkbox {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      border: 1px solid #d1d5db;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      cursor: pointer;
      background: white;
    }

    .checkbox.checked {
      background: #22c55e;
      border-color: #16a34a;
      color: white;
    }

    .item-row.bought .item-name {
      text-decoration: line-through;
      color: #9ca3af;
    }

    .item-row.bought .item-price {
      color: #9ca3af;
    }

    .footer-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
    }

    .btn-ghost {
      flex: 1;
      border-radius: 999px;
      border: 1px dashed #e5e7eb;
      background: #f9fafb;
      color: #6b7280;
      font-size: 11px;
      padding: 6px 10px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      justify-content: center;
    }

    .btn-ghost.danger {
      background: #fef2f2;
      color: #b91c1c;
      border-style: solid;
      border-color: #fecaca;
    }

    .small-icon {
      font-size: 13px;
    }

    @media (max-width: 480px) {
      .card {
        border-radius: 18px;
        padding: 14px 14px 16px;
      }

      .form-row {
        grid-template-columns: 1.4fr 0.6fr 0.8fr;
      }

      .totals-row {
        grid-template-columns: 1fr;
      }

      .footer-actions {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <div class="card-inner">
        <header class="card-header">
          <div class="logo-pill">
            <span>üõí</span>
          </div>
          <div class="title-block">
            <h1>Alƒ±≈üveri≈ü Asistanƒ±m</h1>
            <p>Liste yap, harcamanƒ± kontrol et.</p>
            <div class="pill-row">
              <span class="pill">Market</span>
              <span class="pill">Eczane</span>
              <span class="pill">Ev</span>
              <span class="pill">Teknoloji</span>
            </div>
          </div>
          <div class="status-pill">
            <span class="status-dot"></span>
            <span id="save-status">Kayƒ±tlar saklanƒ±yor</span>
          </div>
        </header>

        <div class="tabs" id="category-tabs">
          <!-- JS ile doldurulacak -->
        </div>

        <form id="item-form">
          <div class="form-row">
            <input id="item-name" class="input" type="text" placeholder="√úr√ºn adƒ± (√∂r. S√ºt)" autocomplete="off" />
            <input id="item-qty" class="input" type="number" min="1" step="1" value="1" />
            <input id="item-price" class="input" type="number" min="0" step="0.01" placeholder="Fiyat (TL)" />
          </div>

          <div class="form-row-2">
            <select id="item-category" class="input">
              <option value="Market">Market</option>
              <option value="Eczane">Eczane</option>
              <option value="Ev">Ev</option>
              <option value="Teknoloji">Teknoloji</option>
            </select>
            <button type="submit" class="btn-primary">
              <span class="small-icon">Ôºã</span> Ekle
            </button>
          </div>
        </form>

        <div class="totals-row">
          <div class="total-card">
            <div class="total-label">
              <span>Se√ßili kategori</span>
              <span class="total-badge" id="current-category-label">Market</span>
            </div>
            <div class="total-value" id="category-total">0,00 TL</div>
            <div class="total-subline" id="category-subline">Alƒ±nan: 0,00 TL</div>
          </div>

          <div class="total-card">
            <div class="total-label">
              <span>Genel toplam</span>
              <span class="total-badge chip-danger">T√ºm kategoriler</span>
            </div>
            <div class="total-value" id="overall-total">0,00 TL</div>
            <div class="total-subline" id="overall-subline">Alƒ±nan: 0,00 TL</div>
          </div>
        </div>

        <section class="list-section">
          <div class="list-header">
            <span>Liste</span>
            <span class="badge-count" id="item-count-badge">0 √ºr√ºn</span>
          </div>
          <div id="items-container">
            <!-- JS ile doldurulacak -->
          </div>
        </section>

        <div class="footer-actions">
          <button class="btn-ghost" id="clear-current-category">
            <span class="small-icon">üßπ</span>
            <span>Sadece bu kategoriyi temizle</span>
          </button>
          <button class="btn-ghost" id="clear-bought">
            <span class="small-icon">‚úÖ</span>
            <span>Alƒ±nanlarƒ± kaldƒ±r</span>
          </button>
          <button class="btn-ghost danger" id="clear-all">
            <span class="small-icon">üóë</span>
            <span>T√ºm listeyi sƒ±fƒ±rla</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const categories = ["Market", "Eczane", "Ev", "Teknoloji"];
    let currentCategory = "Market";
    let items = [];

    const STORAGE_KEY = "alisveris_asistanim_v1";

    const tabsEl = document.getElementById("category-tabs");
    const itemForm = document.getElementById("item-form");
    const nameInput = document.getElementById("item-name");
    const qtyInput = document.getElementById("item-qty");
    const priceInput = document.getElementById("item-price");
    const categorySelect = document.getElementById("item-category");
    const currentCategoryLabel = document.getElementById("current-category-label");
    const categoryTotalEl = document.getElementById("category-total");
    const categorySublineEl = document.getElementById("category-subline");
    const overallTotalEl = document.getElementById("overall-total");
    const overallSublineEl = document.getElementById("overall-subline");
    const itemsContainer = document.getElementById("items-container");
    const itemCountBadge = document.getElementById("item-count-badge");
    const saveStatusEl = document.getElementById("save-status");

    const btnClearCurrent = document.getElementById("clear-current-category");
    const btnClearBought = document.getElementById("clear-bought");
    const btnClearAll = document.getElementById("clear-all");

    function formatTL(value) {
      return value.toLocaleString("tr-TR", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
      }) + " TL";
    }

    function save() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ items }));
      saveStatusEl.textContent = "Kayƒ±tlar saklanƒ±yor";
      setTimeout(() => {
        saveStatusEl.textContent = "G√ºncel";
      }, 800);
    }

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        if (Array.isArray(data.items)) {
          items = data.items;
        }
      } catch (e) {
        console.error(e);
      }
    }

    function renderTabs() {
      tabsEl.innerHTML = "";
      categories.forEach((cat) => {
        const btn = document.createElement("button");
        btn.className = "tab-btn" + (cat === currentCategory ? " active" : "");
        btn.dataset.category = cat;

        let emoji = "üõí";
        if (cat === "Eczane") emoji = "üíä";
        else if (cat === "Ev") emoji = "üè†";
        else if (cat === "Teknoloji") emoji = "üíª";

        btn.innerHTML = `<span class="emoji">${emoji}</span><span>${cat}</span>`;
        btn.addEventListener("click", () => {
          currentCategory = cat;
          categorySelect.value = cat;
          renderAll();
        });

        tabsEl.appendChild(btn);
      });
    }

    function renderTotals() {
      currentCategoryLabel.textContent = currentCategory;

      let catTotal = 0;
      let catBought = 0;
      let overallTotal = 0;
      let overallBought = 0;

      items.forEach((item) => {
        const line = item.qty * item.price;
        overallTotal += line;
        if (item.bought) {
          overallBought += line;
        }
        if (item.category === currentCategory) {
          catTotal += line;
          if (item.bought) {
            catBought += line;
          }
        }
      });

      categoryTotalEl.textContent = formatTL(catTotal);
      categorySublineEl.textContent = "Alƒ±nan: " + formatTL(catBought);
      overallTotalEl.textContent = formatTL(overallTotal);
      overallSublineEl.textContent = "Alƒ±nan: " + formatTL(overallBought);
    }

    function renderList() {
      itemsContainer.innerHTML = "";
      const sorted = [...items].sort((a, b) => {
        if (a.category === b.category) return a.id - b.id;
        return categories.indexOf(a.category) - categories.indexOf(b.category);
      });

      itemCountBadge.textContent =
        sorted.length === 0 ? "0 √ºr√ºn" : `${sorted.length} √ºr√ºn`;

      if (sorted.length === 0) {
        const empty = document.createElement("div");
        empty.style.fontSize = "12px";
        empty.style.color = "#9ca3af";
        empty.style.padding = "4px 0 2px";
        empty.textContent = "Liste bo≈ü. √úr√ºn eklemeye ba≈üla.";
        itemsContainer.appendChild(empty);
        return;
      }

      sorted.forEach((item) => {
        const row = document.createElement("div");
        row.className = "item-row" + (item.bought ? " bought" : "");

        const left = document.createElement("div");
        left.className = "item-left";

        const checkbox = document.createElement("div");
        checkbox.className = "checkbox" + (item.bought ? " checked" : "");
        checkbox.innerHTML = item.bought ? "‚úì" : "";
        checkbox.addEventListener("click", () => {
          item.bought = !item.bought;
          save();
          renderAll();
        });

        const textBlock = document.createElement("div");
        const nameEl = document.createElement("div");
        nameEl.className = "item-name";
        nameEl.textContent = item.name;

        const metaEl = document.createElement("div");
        metaEl.className = "item-meta";
        metaEl.innerHTML = `${item.qty} adet ‚Ä¢ <span class="category-pill">${item.category}</span>`;

        textBlock.appendChild(nameEl);
        textBlock.appendChild(metaEl);

        left.appendChild(checkbox);
        left.appendChild(textBlock);

        const priceEl = document.createElement("div");
        priceEl.className = "item-price";
        const lineTotal = item.qty * item.price;
        priceEl.textContent = formatTL(lineTotal);

        const actions = document.createElement("div");
        actions.className = "item-actions";

        const deleteBtn = document.createElement("button");
        deleteBtn.className = "btn-link danger";
        deleteBtn.textContent = "Sil";
        deleteBtn.addEventListener("click", () => {
          items = items.filter((i) => i.id !== item.id);
          save();
          renderAll();
        });

        actions.appendChild(deleteBtn);

        row.appendChild(left);
        row.appendChild(priceEl);
        row.appendChild(actions);

        itemsContainer.appendChild(row);
      });
    }

    function renderAll() {
      renderTabs();
      renderTotals();
      renderList();
    }

    itemForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const name = nameInput.value.trim();
      const qty = parseFloat(qtyInput.value || "1");
      const price = parseFloat(priceInput.value || "0");
      const category = categorySelect.value;

      if (!name) {
        nameInput.focus();
        return;
      }

      items.push({
        id: Date.now(),
        name,
        qty: isNaN(qty) || qty <= 0 ? 1 : qty,
        price: isNaN(price) || price < 0 ? 0 : price,
        category,
        bought: false,
      });

      nameInput.value = "";
      qtyInput.value = "1";
      priceInput.value = "";
      save();
      renderAll();
    });

    btnClearCurrent.addEventListener("click", (e) => {
      e.preventDefault();
      items = items.filter((i) => i.category !== currentCategory);
      save();
      renderAll();
    });

    btnClearBought.addEventListener("click", (e) => {
      e.preventDefault();
      items = items.filter((i) => !i.bought);
      save();
      renderAll();
    });

    btnClearAll.addEventListener("click", (e) => {
      e.preventDefault();
      if (!confirm("T√ºm listeyi silmek istediƒüine emin misin?")) return;
      items = [];
      save();
      renderAll();
    });

    // Ba≈ülangƒ±√ß
    load();
    renderAll();
  </script>
</body>
</html>
